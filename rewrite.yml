---
# This OpenRewrite recipe migrates `pom.xml` files from EAP 7.x to EAP 8.x as outlined here:
# https://docs.redhat.com/en/documentation/red_hat_jboss_enterprise_application_platform/8.0/html/migration_guide/migrate-a-jboss-eap-application-s-maven-project-to-jboss-eap-8-0_default#migrate-a-jboss-eap-application-s-maven-project-to-jboss-eap-8-0_default
# and others, such as Hibernate.
type: specs.openrewrite.org/v1beta/recipe
name: EAP80
displayName: Migrate EAP 7.4/EE8 Dependencies and more to EAP 8.0/EE10
description: Updates EAP BOM coordinates and migrates EE8 artifacts to EE10 based on those changes. Also removes outdated dependencies.
recipeList:
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.bom
      oldArtifactId: jboss-eap-jakartaee8
      newArtifactId: jboss-eap-ee
      newVersion: 8.0.4.GA-redhat-00006

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.bom
      oldArtifactId: jboss-eap-jakartaee8-with-tools
      newArtifactId: jboss-eap-ee-with-tools
      newVersion: 8.0.4.GA-redhat-00006

  # `org.jboss.spec:jboss-javaee-8.0` is not mentioned in the migration guide.
  #  At this point, we assume the use of the comprehensive BOM from EAP 8.0.
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec
      oldArtifactId: jboss-javaee-8.0
      newGroupId: org.jboss.bom
      newArtifactId: jboss-eap-ee
      newVersion: 8.0.4.GA-redhat-00006

  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: org.wildfly
      artifactId: wildfly-ejb-client-legacy-bom

  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: org.jboss.spec
      artifactId: jboss-jakartaee-8.0

  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: org.jboss.spec
      artifactId: jboss-jakartaee-web-8.0

  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: org.jboss.bom
      artifactId: eap-runtime-artifacts

  # When migrating to Jakarta EE 10, it is essential to remove javax artifacts from the dependency management section
  # the pom.xml. These dependencies are now managed through the Bill of Materials (BOM) provided by the
  # Jakarta EE specifications or Red Hat's JBoss Enterprise Application Platform (EAP).
  # This approach ensures consistency and compatibility with Jakarta EE 10 standards.
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.activation
      artifactId: javax.activation-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.annotation
      artifactId: javax.annotation-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.el
      artifactId: javax.el-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.interceptor
      artifactId: javax.interceptor-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.mail
      artifactId: javax.mail-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.persistence
      artifactId: javax.persistence-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.servlet
      artifactId: javax.servlet-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.servlet.jsp
      artifactId: javax.servlet.jsp-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.websocket
      artifactId: javax.websocket-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.ws.rs
      artifactId: javax.ws.rs-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.xml.bind
      artifactId: javax.xml.bind-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.xml.soap
      artifactId: javax.xml.soap-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.xml.ws
      artifactId: javax.xml.ws-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.validation
      artifactId: validation-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.faces
      artifactId: javax.faces-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.faces
      artifactId: jsf-api
  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: javax.faces
      artifactId: jsf-impl

  # ---- end

  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: org.hibernate
      artifactId: hibernate-core

  - org.openrewrite.maven.RemoveManagedDependency:
      groupId: org.hibernate
      artifactId: hibernate-entitymanager

  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: jakarta.platform
      artifactId: jakarta.jakartaee-bom
      newVersion: 10.0.0

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.jws
      oldArtifactId: jsr181-api
      newArtifactId: jboss-jakarta-xml-ws-api_4.0_spec
      newGroupId: org.jboss.spec.jakarta.xml.ws

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.xml.ws
      oldArtifactId: jboss-jaxws-api_2.3_spec
      newArtifactId: jboss-jakarta-xml-ws-api_4.0_spec
      newGroupId: org.jboss.spec.jakarta.xml.ws

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: com.sun.activation
      oldArtifactId: javax.activation
      newGroupId: jakarta.activation
      newArtifactId: jakarta.activation-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.annotation
      oldArtifactId: javax.annotation-api
      newGroupId: jakarta.annotation
      newArtifactId: jakarta.annotation-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.annotation
      oldArtifactId: jboss-annotations-api_1.3_spec
      newGroupId: jakarta.annotation
      newArtifactId: jakarta.annotation-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.security.auth.message
      oldArtifactId: jboss-jaspi-api_1.0_spec
      newGroupId: jakarta.authentication
      newArtifactId: jakarta.authentication-api
      changeManagedDependency: true
      overrideManagedVersion: false
      newVersion: "*"

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.security.jacc
      oldArtifactId: jboss-jacc-api_1.5_spec
      newGroupId: jakarta.authorization
      newArtifactId: jakarta.authorization-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.batch
      oldArtifactId: jboss-batch-api_1.0_spec
      newGroupId: jakarta.batch
      newArtifactId: jakarta.batch-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.batch
      oldArtifactId: javax.batch-api
      newGroupId: jakarta.batch
      newArtifactId: jakarta.batch-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.ejb
      oldArtifactId: jboss-ejb-api_3.2_spec
      newGroupId: jakarta.ejb
      newArtifactId: jakarta.ejb-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.ejb
      oldArtifactId: javax.ejb-api
      newGroupId: jakarta.ejb
      newArtifactId: jakarta.ejb-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.el
      oldArtifactId: jboss-el-api_3.0_spec
      newGroupId: org.jboss.spec.jakarta.el
      newArtifactId: jboss-el-api_5.0_spec

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.el
      oldArtifactId: javax.el-api
      newGroupId: jakarta.el
      newArtifactId: jakarta.el-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.enterprise.concurrent
      oldArtifactId: jboss-concurrency-api_1.0_spec
      newGroupId: jakarta.enterprise.concurrent
      newArtifactId: jakarta.enterprise.concurrent-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.faces
      oldArtifactId: jboss-jsf-api_2.3_spec
      newGroupId: jakarta.faces
      newArtifactId: jakarta.faces-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.faces
      oldArtifactId: jsf-api
      newGroupId: jakarta.faces
      newArtifactId: jakarta.faces-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.faces
      oldArtifactId: javax.faces-api
      newGroupId: jakarta.faces
      newArtifactId: jakarta.faces-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.interceptor
      oldArtifactId: jboss-interceptors-api_1.2_spec
      newGroupId: jakarta.interceptor
      newArtifactId: jakarta.interceptor-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.jms
      oldArtifactId: jboss-jms-api_2.0_spec
      newGroupId: jakarta.jms
      newArtifactId: jakarta.jms-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: com.sun.mail
      oldArtifactId: javax.mail
      newGroupId: jakarta.mail
      newArtifactId: jakarta.mail-api
      newVersion: "2.1.*"

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.mail
      oldArtifactId: javax.mail-api
      newGroupId: jakarta.mail
      newArtifactId: jakarta.mail-api
      newVersion: "2.1.*"

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.resource
      oldArtifactId: jboss-connector-api_1.7_spec
      newGroupId: jakarta.resource
      newArtifactId: jakarta.resource-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.servlet
      oldArtifactId: jboss-servlet-api_4.0_spec
      newGroupId: jakarta.servlet
      newArtifactId: jakarta.servlet-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.servlet.jsp
      oldArtifactId: jboss-jsp-api_2.3_spec
      newGroupId: jakarta.servlet.jsp
      newArtifactId: jakarta.servlet.jsp-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.servlet.jsp
      oldArtifactId: javax.servlet.jsp-api
      newGroupId: jakarta.servlet.jsp
      newArtifactId: jakarta.servlet.jsp-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.apache.taglibs
      oldArtifactId: taglibs-standard-spec
      newGroupId: jakarta.servlet.jsp.jstl
      newArtifactId: jakarta.servlet.jsp.jstl-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.transaction
      oldArtifactId: jboss-transaction-api_1.3_spec
      newGroupId: jakarta.transaction
      newArtifactId: jakarta.transaction-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.xml.bind
      oldArtifactId: jboss-jaxb-api_2.3_spec
      newGroupId: jakarta.xml.bind
      newArtifactId: jakarta.xml.bind-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.xml.bind
      oldArtifactId: javax.xml.bind-api
      newGroupId: jakarta.xml.bind
      newArtifactId: jakarta.xml.bind-api

  #  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
  #      oldGroupId: javax.xml.bind
  #      oldArtifactId: jsr173_api
  #      newGroupId: jakarta.xml.bind
  #      newArtifactId: jakarta.xml.bind-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.xml.ws
      oldArtifactId: jboss-jaxws-api_2.3_spec
      newGroupId: org.jboss.spec.jakarta.xml.ws
      newArtifactId: jboss-jakarta-xml-ws-api_4.0_spec

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.xml.ws
      oldArtifactId: javax.xml.ws-api
      newGroupId: jakarta.xml.ws
      newArtifactId: jakarta.xml.ws-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.websocket
      oldArtifactId: jboss-websocket-api_1.1_spec
      newGroupId: jakarta.websocket
      newArtifactId: jakarta.websocket-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.websocket
      oldArtifactId: javax.websocket-api
      newGroupId: jakarta.websocket
      newArtifactId: jakarta.websocket-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.ws.rs
      oldArtifactId: jboss-jaxrs-api_2.1_spec
      newGroupId: jakarta.ws.rs
      newArtifactId: jakarta.ws.rs-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.spec.javax.xml.soap
      oldArtifactId: jboss-saaj-api_1.4_spec
      newGroupId: org.jboss.spec.jakarta.xml.soap
      newArtifactId: jboss-saaj-api_3.0_spec

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.xml.soap
      oldArtifactId: javax.xml.soap-api
      newGroupId: jakarta.xml.soap
      newArtifactId: jakarta.xml.soap-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.jboss.narayana.xts
      oldArtifactId: jbossxts
      newArtifactId: jbossxts-jakarta
      newVersion: 5.13.1.Final

  - org.openrewrite.maven.ChangeDependencyClassifier:
      groupId: org.jboss.narayana.xts
      artifactId: jbossxts-jakarta
      newClassifier: api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.hibernate
      oldArtifactId: hibernate-core
      newGroupId: org.hibernate.orm
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.hibernate
      oldArtifactId: hibernate-envers
      newGroupId: org.hibernate.orm
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.hibernate
      oldArtifactId: hibernate-jpamodelgen
      newGroupId: org.hibernate.orm

  # Instead of continuing to rely on specific vendor APIs,
  # Hibernate has increasingly adopted the JCache standard since version 5.x.
  # This allows various cache implementations—including Ehcache 3.x—
  # to be integrated via JCache adapter layers.
  #
  # If you want to use Ehcache 3, you now do so by using `hibernate-jcache`
  # and binding Ehcache 3.x as the underlying JCache provider.
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.hibernate
      oldArtifactId: hibernate-ehcache
      newGroupId: org.hibernate.orm
      newArtifactId: hibernate-jcache
      newVersion: "6.1.*"

  # The component `hibernate-entitymanager` has been moved to the core project `hibernate-core`.
  # Existing versions are not relevant because `hibernate-core` is included in the EAP dependency management.
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.hibernate
      oldArtifactId: hibernate-entitymanager
      newGroupId: org.hibernate.orm
      newArtifactId: hibernate-core
  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: org.hibernate.validator
      artifactId: hibernate-validator
      newVersion: "8.0.*"
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.hibernate
      oldArtifactId: hibernate-validator-annotation-processor
      newGroupId: org.hibernate.validator
      newVersion: "8.0.*"
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.hibernate
      oldArtifactId: hibernate-search
      newGroupId: org.hibernate.search
      newArtifactId: hibernate-search-mapper-orm-orm6
      newVersion: "6.2.*"
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: org.hibernate
      oldArtifactId: hibernate-search-engine
      newGroupId: org.hibernate.search
      newVersion: "6.2.*"
  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: org.hibernate
      artifactId: hibernate-c3p0
      newVersion: "6.2.*"

  # -------------------------------------------------------------------------------------
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.servlet
      oldArtifactId: javax.servlet-api
      newGroupId: jakarta.servlet
      newArtifactId: jakarta.servlet-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.ws.rs
      oldArtifactId: javax.ws.rs-api
      newGroupId: jakarta.ws.rs
      newArtifactId: jakarta.ws.rs-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.persistence
      oldArtifactId: javax.persistence-api
      newGroupId: jakarta.persistence
      newArtifactId: jakarta.persistence-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.inject
      oldArtifactId: javax.inject
      newGroupId: jakarta.inject
      newArtifactId: jakarta.inject-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.enterprise
      oldArtifactId: cdi-api
      newGroupId: jakarta.enterprise
      newArtifactId: jakarta.enterprise.cdi-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.validation
      oldArtifactId: validation-api
      newGroupId: jakarta.validation
      newArtifactId: jakarta.validation-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.interceptor
      oldArtifactId: javax.interceptor-api
      newGroupId: jakarta.interceptor
      newArtifactId: jakarta.interceptor-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.mail
      oldArtifactId: mail
      newGroupId: jakarta.mail
      newArtifactId: jakarta.mail-api
      newVersion: "2.1.*"

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.json
      oldArtifactId: javax.json-api
      newGroupId: jakarta.json
      newArtifactId: jakarta.json-api

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.json.bind
      oldArtifactId: javax.json.bind-api
      newGroupId: jakarta.json.bind
      newArtifactId: jakarta.json.bind-api

  # In Jakarta EE 10, the jsf-facelets artifact from the
  # com.sun.facelets group is no longer used, as Facelets has been integrated into the core of Jakarta Server Faces (JSF).
  # Therefore, you don't need to include a separate dependency for Facelets in your pom.xml. Instead, ensure that you have
  # the appropriate JSF implementation for Jakarta EE 10. For example, you can include the following dependency:
  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: com.sun.facelets
      oldArtifactId: jsf-facelets
      newGroupId: org.glassfish
      newArtifactId: jakarta.faces
      newVersion: 4.0.0
      scope: provided

  - org.openrewrite.maven.ChangeDependencyGroupIdAndArtifactId:
      oldGroupId: javax.faces
      oldArtifactId: jsf-impl
      newGroupId: org.glassfish
      newArtifactId: jakarta.faces
      newVersion: 4.0.0
      scope: provided

  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: org.jboss.weld
      artifactId: weld-junit-parent
      newVersion: 4.0.x
      scope: provided

  - org.openrewrite.java.migrate.jakarta.JakartaEE10
  - org.openrewrite.hibernate.MigrateToHibernate62

  - org.openrewrite.maven.RemoveRedundantDependencyVersions:
      groupPattern: "*"
      artifactPattern: "*"
      onlyIfManagedVersionIs: "ANY"

  # Merging libraries during migration results in duplicate dependencies, which, if not resolved, cause maven warnings.
  - org.openrewrite.maven.RemoveDuplicateDependencies
